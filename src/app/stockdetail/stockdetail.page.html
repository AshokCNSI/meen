<ion-header translucent>
  <ion-toolbar>
	<ion-buttons style="font-size: 25px;margin: 10px;" slot="start" (click)="location.back()">
		<ion-icon name="arrow-back-outline"></ion-icon>
	</ion-buttons>
    <ion-title>{{authService.getUserType() == 'SA' || authService.getUserType() == 'A' ? 'Stock' : 'Products'}} Detail</ion-title>
	<ion-buttons slot="primary" style="font-size: 25px;margin: 10px;" (click)="saveStock()" *ngIf="(authService.getUserType() == 'A' || authService.getUserType() == 'SA') && productVisibility == 'R'">
        <ion-icon name="push-outline"></ion-icon>
    </ion-buttons>
	<ion-buttons slot="primary" style="font-size: 25px;margin: 10px;" (click)="updateStatus()" *ngIf="(authService.getUserType() == 'S' || authService.getUserType() == 'D') && (productVisibility != 'AC' && productVisibility != 'R' && oldStatus!='DE')">
        <ion-icon name="arrow-up-circle-outline"></ion-icon>
    </ion-buttons>
  </ion-toolbar>
  
</ion-header>


<ion-content>

<ion-card>
	<img alt="M" style="width:100%;height:200px;" src="{{imagepath}}" onerror="this.onerror=null;this.src='https://www.nicepng.com/png/detail/128-1282756_svg-free-download-marlin-clipart-deep-sea-fishing.png';">
	<ion-card-header>
	  <ion-card-subtitle>{{title}}</ion-card-subtitle>
	  <ion-card-title>&#x20b9; {{price}}</ion-card-title>
	  <ionic5-star-rating #rating
		activeIcon = "star"
		defaultIcon = "star-outline"
		activeColor = "#488aff" 
		defaultColor = "#488aff"
		readonly="true"
		rating="3"
		fontSize = "15px"
		(ratingChanged)="logRatingChange($event)">
	</ionic5-star-rating>
	</ion-card-header>
	<ion-card-content>
	  {{details}}
	</ion-card-content>
  </ion-card>
<ng-container *ngIf="productVisibility == 'R' && (authService.getUserType() == 'SA' || authService.getUserType() == 'A')">
<div *ngIf="isSubmitted && errorControl.title.errors?.required"
		class="validator-error">
	  Enter Title of the Product.
	</div>
  <form [formGroup]="formData" id="formData" novalidate>
	  <ion-item>
		  <ion-label position="floating">Title</ion-label>
		  <ion-input type="text" formControlName="title" [(ngModel)]="title" required></ion-input>
		</ion-item>
		<ion-item>
		  <ion-label position="floating">Description</ion-label>
		  <ion-textarea formControlName="details" [(ngModel)]="details"></ion-textarea>
		</ion-item>
		<ion-item>
		  <ion-label position="floating">Image Path</ion-label>
		  <ion-textarea formControlName="imagepath" [(ngModel)]="imagepath"></ion-textarea>
		</ion-item>
	</form>
</ng-container>
<ng-container *ngIf="((productVisibility != 'R') && (authService.getUserType() == 'C' || authService.getUserType() == 'S'))
		|| ((authService.getUserType() == 'D'))">
    <ion-item (click)="selectAddress()" *ngIf="(productVisibility == 'AC')">
		<ion-note slot="start">Delivering to</ion-note>
		<ion-label *ngIf="!dindex && productVisibility == 'AC'">No Address Selected</ion-label>
		<ion-label *ngIf="dindex && productVisibility == 'AC'">Click to change address</ion-label>
	</ion-item>
	<ion-card *ngIf="dindex">
	  <ion-card-header>
		<ion-card-subtitle>{{dname}}</ion-card-subtitle>
		<ion-card-title>{{dmobile}}</ion-card-title>
	  </ion-card-header>

	  <ion-card-content>
		{{dhouseno}}
		{{dstreetname}}
		{{dlandmark}}
	  </ion-card-content>
	</ion-card>
</ng-container>
<ng-container *ngIf="(productVisibility == 'R' || productVisibility == 'AC') && (authService.getUserType() == 'C' || !authService.getIsUserLoggedIn())">
	<div *ngIf="isSubmitted && errorOrderControl.quantity.errors?.required"
		class="validator-error">
	  Enter quantity of the product.
	</div>
	<div *ngIf="isSubmitted && errorOrderControl.cookingpurpose.errors?.required"
		class="validator-error">
	  Please select the type of piece you want.
	</div>
	<div *ngIf="isSubmitted && errorOrderControl.masala.errors?.required"
	class="validator-error">
	  Please select masala.
	</div>
	<div *ngIf="isSubmitted && errorOrderControl.description.errors?.required"
	class="validator-error">
	  Please give description.
	</div>
<form [formGroup]="orderData" id="orderData" (ngSubmit)="productVisibility == 'AC' ? orderConfirm() : addToCart()" novalidate>
		<ion-item>
		  <ion-label position="floating">How much you need in Kg?</ion-label>
		  <ion-input type="number" formControlName="quantity" [(ngModel)]="quantity" required disabled="{{ordervisibility}}"></ion-input>
		  <ion-buttons slot="primary" style="font-size: 25px;margin: 10px;" slot="end" (click)="removeNumber()">
			<ion-icon name="remove-circle-outline"></ion-icon>
		  </ion-buttons>
		  <ion-buttons slot="primary" style="font-size: 25px;margin: 10px;" slot="end" (click)="addNumber()">
			<ion-icon name="add-circle-outline"></ion-icon>
		  </ion-buttons>
		</ion-item>
		<ion-item>
		  <ion-label>Purpose</ion-label>
		  <ion-select [(ngModel)]="cookingpurpose" formControlName="cookingpurpose" interface="action-sheet" required disabled="{{ordervisibility}}">
			<ion-select-option value="FR">Fry</ion-select-option>
			<ion-select-option value="GA">Gravy</ion-select-option>
			<ion-select-option value="TA">Tawa Fry</ion-select-option>
			<ion-select-option value="CH">Chilli</ion-select-option>
			<ion-select-option value="CR">Cross cut</ion-select-option>
			<ion-select-option value="FI">Fillet</ion-select-option>
		  </ion-select>
		</ion-item>
		<ion-item>
		  <ion-label>Masala</ion-label>
		  <ion-select [(ngModel)]="masala" formControlName="masala" interface="action-sheet" required disabled="{{ordervisibility}}">
			<ion-select-option value="Y">Yes</ion-select-option>
			<ion-select-option value="N">No</ion-select-option>
		  </ion-select>
		</ion-item>
		<ion-item *ngIf="masala == 'Y'">
		  <ion-label position="floating">Masala Quantity</ion-label>
		  <ion-input type="number" formControlName="masalaquantity" [(ngModel)]="masalaquantity" required disabled="{{ordervisibility}}"></ion-input>
		  <ion-buttons slot="primary" style="font-size: 25px;margin: 10px;" slot="end" (click)="removeMasalaQuantity()">
			<ion-icon name="remove-circle-outline"></ion-icon>
		  </ion-buttons>
		  <ion-buttons slot="primary" style="font-size: 25px;margin: 10px;" slot="end" (click)="addMasalaQuantity()">
			<ion-icon name="add-circle-outline"></ion-icon>
		  </ion-buttons>
		</ion-item>
		<ion-item>
		  <ion-label position="floating">Any Description</ion-label>
		  <ion-textarea formControlName="description" [(ngModel)]="description" disabled="{{ordervisibility}}"></ion-textarea>
		</ion-item>
	
		<ng-container *ngIf="productVisibility != 'R'">
		
		<ion-list *ngIf="productVisibility == 'AC' && (authService.getUserType() == 'C')">
			<ion-item-divider>
			  <ion-label>
				Price Details
			  </ion-label>
			</ion-item-divider>
			<ion-item>
			  <ion-label>Actual Price </ion-label>
			  <ion-note slot="end">&#x20b9;{{price + discountprice}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Selling price</ion-label>
			  <ion-note slot="end">&#x20b9;{{price}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Discount price</ion-label>
			  <ion-note slot="end">&#x20b9;{{discountprice}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Total price in quality</ion-label>
			  <ion-note slot="end">&#x20b9;{{price * quantity}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Delivery charge</ion-label>
			  <ion-note slot="end">&#x20b9;{{delieverycharge}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Masala charge &#x20b9;{{masalacharge}} per kg</ion-label>
			  <ion-note slot="end">{{masala == 'Y' ? quantity * masalacharge : 0}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>You need to pay</ion-label>
			  <ion-note slot="end">&#x20b9;{{price * quantity + delieverycharge + (masala == 'Y' ? quantity * masalacharge : 0)}}</ion-note>
			</ion-item>
		</ion-list>
		
		</ng-container>
		
		<ion-row>
		<ng-container *ngIf="productVisibility == 'R'">
		  <ion-col style="text-align:center;">
			 <ion-button expand="block" color="danger" type="submit">Add to Cart</ion-button>
		  </ion-col>
		</ng-container>
		<ng-container *ngIf="productVisibility == 'AC'">
		  <ion-col style="text-align:center;">
			 <ion-button expand="block" color="danger" (click)="cancelOrder()">Cancel Order</ion-button>
		  </ion-col>
		  <ion-col style="text-align:center;">
			 <ion-button expand="block" color="success" type="submit" [disabled]="!dindex">Confirm Order</ion-button>
		  </ion-col>
		</ng-container>
		</ion-row>
	</form>
</ng-container>
<ion-list *ngIf="(productVisibility != 'AC' && productVisibility != 'R') && (authService.getUserType() == 'C' || authService.getUserType() == 'S' || authService.getUserType() == 'D')">
			<ion-item-divider>
			  <ion-label>
				Price Details
			  </ion-label>
			</ion-item-divider>
			<ion-item>
			  <ion-label>Actual Price </ion-label>
			  <ion-note slot="end">&#x20b9;{{oactualprice}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Sold price</ion-label>
			  <ion-note slot="end">&#x20b9;{{osellingprice}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Discount price</ion-label>
			  <ion-note slot="end">&#x20b9;{{odiscountprice}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Total price in quality</ion-label>
			  <ion-note slot="end">&#x20b9;{{ototalprice}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Delivery charge</ion-label>
			  <ion-note slot="end">&#x20b9;{{odeliverycharge}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>Masala charge &#x20b9;{{omasalacharge}} per kg</ion-label>
			  <ion-note slot="end">{{omasalatotalcharge}}</ion-note>
			</ion-item>
			<ion-item>
			  <ion-label>You have to pay</ion-label>
			  <ion-note slot="end">&#x20b9;{{ofinalprice}}</ion-note>
			</ion-item>
		</ion-list>
	<ng-container *ngIf="productVisibility != 'AC' && productVisibility != 'R'">
		  <ng-container *ngFor="let p of statusList;">
		  <ion-list-header *ngIf="productVisibility != 'AC' && productVisibility != 'R' && productVisibility == p.code">
			  <ion-label>
				{{p.name}}
			  </ion-label>
			  <ion-progress-bar value="{{p.buffer}}" buffer="0.5"></ion-progress-bar>
			  </ion-list-header>
		  </ng-container>
	</ng-container>
<ng-container *ngIf="oldStatus != 'DE' && (authService.getUserType() == 'D' && assignedto == authService.getUserID()) || (productVisibility != 'AC' && productVisibility != 'R' && productVisibility != 'DE') && ((authService.getUserType() == 'S' || authService.getUserType() == 'D') && !assignedto)">
	<ion-item>
	  <ion-label>Change Order Status</ion-label>
	  <ion-select [(ngModel)]="productVisibility" interface="action-sheet">
		<ng-container *ngFor="let p of statusList;">
			<ion-select-option value="{{p.code}}" *ngIf="((p.code != 'ORD' && p.code != 'DS' && p.code != 'IPD' && p.code != 'DE') && authService.getUserType() == 'S') || ((p.code != 'ORD' && p.code != 'INP' && p.code != 'CL') && authService.getUserType() == 'D')">{{p.name}}</ion-select-option>
		</ng-container>
	  </ion-select>
	</ion-item>
</ng-container>
<ng-container *ngIf="oldStatus == 'DE'">
	<p class="no-items" >Delievered Successfully.</p>
</ng-container>
</ion-content>
